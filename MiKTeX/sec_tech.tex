\lstset{style=fsharpstyle}

\section{РАЗРАБОТКА ОСНОВНЫХ УСТРОЙСТВ МИКРО-ЭВМ}
\label{sec:practice:technology_used}

В данном разделе подробно описывается состав и принципы работы основных блоков микро-ЭВМ.

\subsection{Запоминающие устройства. Функциональный состав и временные диаграммы работы ОЗУ}
Блок ram\_block включает в себя синхронные ram и rom, переключение между блоками осуществляется на основе старшего бита адреса.
Временные диаграммы чтения и записи ОЗУ представлены на рисунках 2.1 и 2.2.

Содержимое ROM памяти включает в себя коды команд, записанные последовательно в том порядке, в котором выполняется программа.
Память команд хранится в файле rom.hex.

Блок `ram\_block` содержит 2 входа:
\begin{itemize}
    \item address[10..0] -- адрес ячейки для чтения/записи
    \item control[1..0] -- тактирующий импульс и сигнал режима чтение/запись
\end{itemize}
Двунаправленный вход data[15..0] служит для подключения шины данных.

Содержимое RAM памяти представляет собой данные, которыми оперирует процессор, и в которые происходит запись результатов работы. Содержимое памяти может быть проинициализировано в файле ram.hex.

Синхронная RAM выдает данные на выход на следующем такте, после указания адреса и установления единичного сигнала на входе outenab.

Сигнал inclock на выходах RAM и ROM устанавливается по спаду тактирующего сигнала, outclock -- по фронту.

\subsection{Устройство управления}
Устройство управления устанвливает сигналы, разрешающие работу определенных блоков.
Данный блок представлен в файле 'cu.bdf'.

На вход подается единственный сигнал -- clk. Он служит для тактирования УУ.

Выходы:
\begin{itemize}
    \item stage[3..0] -- отладочный сигнал для наглядного просмотра текущей стадии выполнения команды
    \item read\_com1 -- считывние первого слова команды
    \item read\_com2 -- считывние второго слова команды
    \item decode -- этап декодирования команды
    \item read\_op1 -- чтение первого операнда
    \item read\_op21 -- начало чтения второго операнда
    \item read\_op22 -- запрос в память при косвенной адресации
    \item read\_op23 -- сохранение операнда, полученного из памяти, при косвенной адресации
    \item execute1 -- первый такт операций над операндами
    \item execute2 -- второй такт операций над операндами
    \item write1 -- начало записи результата
    \item write2 -- конец записи результата
    \item res1 - res5 -- резервные выходы
    \item data[15..0] -- слово из ОЗУ
\end{itemize}

\subsection{Блок выборки инструкций}
Данный блок осуществляет выборку инструкций, а также их декодирование.
Блок включает в себя 2 регистра для хранения слов команд, счетчик инструкций.
Схему блока можно найти в файле 'if.bdf'.

Входные сигналы:
\begin{itemize}
    \item clk -- тактирующий сигнал
    \item read\_com1 -- чтение первого слова из памяти
    \item read\_com2 -- чтение второго слова из памяти
    \item decode -- декодирование команды
    \item sign -- флаг знака, служит для операции перехода js
    \item execute1 -- в комбинации с активными сигналами jmp или js и sign приводит к переходу по адресу goto[10..0]
    \item goto[10..0] -- адрес перехода
\end{itemize}
Выходные сигналы:
\begin{itemize}
    \item dec\_d -- декремент. Прямая регистровая адресация
    \item and\_d -- поразрядное И. Прямая регистровая адресация
    \item nand\_d -- поразрядое И-НЕ. Прямая регистровая адресация
    \item ror\_d -- циклический сдвиг вправоИ. Прямая регистровая адресация
    \item dec\_u, and\_u, nand\_u, ror\_u -- аналогичны предыдущим. Косвенная регистровая адресация.
    \item jmp -- безусловный переход
    \item js -- перход при старшем бите равным нулю
    \item hlt -- сигнал выключения микро-ЭВМ
    \item push -- занесение регистра в стэк
    \item pop -- чтение регистра из стека
    \item mov\_mr -- пересылка операнда из регистра в память
    \item mov\_rm -- пересылка памяти -> регистр
    \item mov\_rr -- пересылка память -> регистр. Косвенная регистровая адресация
    \item cmd[3..0] -- КОП
    \item mem\_op[10..0] -- адрес операнда, хранящегося в памяти
    \item reg\_d[3..0] -- адрес регистра. Прямая регистровая адресация
    \item reg\_u[3..0] -- адрес регистра. Косвенная регистровая адресация
\end{itemize}

\subsection{Блок выборки операндов}
Осуществляет загрузку операндов из памяти, используя соответсвующую команде адресацию. Блок представлен в файле 'op\_f.bdf'.

Входы:
\begin{itemize}
    \item все выходы с предыдущего блока, за исключением hlt, cmd[3..0]
    \item clk
    \item reg\_op1 - reg\_op23
    \item reg\_data[15..0] -- данные из РОН
    \item data[15..0] -- данные из RAM
\end{itemize}
Выходы:
\begin{itemize}
    \item address[10..0] -- адрес для чтения из RAM
    \item reg\_addr[3..0] -- адрес регистра
    \item op1[15..0] -- первый операнд
    \item op2[15..0] -- второй операнд
    \item reg\_ctl[1..0] -- управляющие РОН сигналы
\end{itemize}

\subsection{АЛУ}
Блок АЛУ выполняет арифметические и логические операции, работает со стеком. Если операнды не нуждаются в обработке(например при командах пересылки), АЛУ отправляет их сразу на выход. Также АЛУ содержит регистр, хранящий знак последних выходных данных с АЛУ.

Входы:
\begin{itemize}
    \item dec\_d
    \item dec\_u
    \item and
    \item nand
    \item ror
    \item push
    \item pop
    \item op1[15..0]
    \item op2[15..0]
\end{itemize}
Выходы:
\begin{itemize}
    \item res[15..0] -- выходной операнд
    \item sign -- флаг установки старшего бита в 1
    \item empty -- стэк пуст
\end{itemize}

\subsection{Блок сохранения результата}

\subsection{Блок РОН}

\subsection{Стэк}
Содержит 11 шестнадцатиразрядных регистров. Позволяет работать с регистрами по принципу FIFO. На схеме блок имеет название 'Stack'.
Входы:
\begin{itemize}
    \item push -- запись регистра в стэк
    \item pop -- освобождение регистра из стека
    \item in[15..0] -- входной регистр
\end{itemize}
Выходы:
\begin{itemize}
    \item out[15..0] -- выходной регистр
    \item empty -- стэк пуст
    \item full -- стэк полон
\end{itemize}
Стэк растет вверх, указатель стэка указывает на следующую свободную ячейку.
При включении сигнала full -- запись в стэк блокируется, при активном сигнале empty -- отсутствует запись операнда команды pop на шаге сохранения операндов.

